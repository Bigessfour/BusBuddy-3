<UserControl x:Class="BusBuddy.WPF.Views.DriverManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
             xmlns:viewModels="clr-namespace:BusBuddy.WPF.ViewModels.Driver"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1200">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/BusBuddy.WPF;component/Resources/SyncfusionV30_Validated_ResourceDictionary.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>

    <UserControl.DataContext>
        <viewModels:DriversViewModel />
    </UserControl.DataContext>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header Section -->
        <Border Grid.Row="0" Background="{StaticResource BusBuddy.Brush.Primary}"
                CornerRadius="8" Padding="20" Margin="0,0,0,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <syncfusion:ButtonAdv Grid.Column="0"
                                      Label="ðŸ‘¨â€âœˆï¸"
                                      FontSize="32"
                                      Background="Transparent"
                                      BorderThickness="0"
                                      Foreground="White"
                                      Margin="0,0,15,0"/>

                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="Driver Management System"
                               FontSize="24" FontWeight="Bold"
                               Foreground="White"/>
                    <TextBlock Text="Manage driver information, licenses, training records, and schedules"
                               FontSize="14" Foreground="White" Opacity="0.9"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <syncfusion:ButtonAdv Label="ðŸ”„ Refresh"
                                          Background="{StaticResource BusBuddy.Brush.Secondary}"
                                          Foreground="White"
                                          BorderThickness="0"
                                          Padding="12,8"
                                          Margin="0,0,10,0"
                                          Command="{Binding RefreshCommand}"
                                          ToolTip="Refresh driver data"
                                          AutomationProperties.Name="Refresh"
                                          AutomationProperties.HelpText="Refresh driver data"/>
                    <syncfusion:ButtonAdv Label="ðŸ“Š Reports"
                                          Background="{StaticResource BusBuddy.Brush.SafetyOrange}"
                                          Foreground="White"
                                          BorderThickness="0"
                                          Padding="12,8"
                                          Command="{Binding GenerateReportsCommand}"
                                          ToolTip="Generate driver reports"
                                          AutomationProperties.Name="Reports"
                                          AutomationProperties.HelpText="Generate driver reports"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Quick Actions Toolbar -->
        <Border Grid.Row="1" Background="{StaticResource BusBuddy.Surface.Light}"
                CornerRadius="6" Padding="15" Margin="0,0,0,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <syncfusion:ButtonAdv Label="âž• Add Driver"
                                          Background="{StaticResource BusBuddy.Brush.Semantic.Success}"
                                          Foreground="White"
                                          BorderThickness="0"
                                          Padding="15,8"
                                          Margin="0,0,10,0"
                                          Command="{Binding AddDriverCommand}"
                                          ToolTip="Add a new driver to the system"
                                          AutomationProperties.Name="Add Driver"
                                          AutomationProperties.HelpText="Add a new driver"/>

                    <syncfusion:ButtonAdv Label="âœï¸ Edit Driver"
                                          Background="{StaticResource BusBuddy.Brush.Semantic.Info}"
                                          Foreground="White"
                                          BorderThickness="0"
                                          Padding="15,8"
                                          Margin="0,0,10,0"
                                          Command="{Binding EditDriverCommand}"
                                          ToolTip="Edit selected driver information"
                                          x:Name="EditDriverButton"/>

                    <syncfusion:ButtonAdv Label="ðŸ—‘ï¸ Remove Driver"
                                          Background="{StaticResource BusBuddy.Brush.Semantic.Error}"
                                          Foreground="White"
                                          BorderThickness="0"
                                          Padding="15,8"
                                          Margin="0,0,10,0"
                                          Command="{Binding DeleteDriverCommand}"
                                          ToolTip="Remove selected driver"
                                          x:Name="RemoveDriverButton"/>

                    <Separator Margin="15,0"/>

                    <syncfusion:ButtonAdv Label="ðŸ“„ License Check"
                                          Background="{StaticResource BusBuddy.Brush.SafetyOrange}"
                                          Foreground="White"
                                          BorderThickness="0"
                                          Padding="15,8"
                                          Margin="0,0,10,0"
                                          Command="{Binding LicenseCheckCommand}"
                                          ToolTip="Check license expiration dates"
                                          AutomationProperties.Name="License Check"
                                          AutomationProperties.HelpText="Check driver license expirations"/>

                    <syncfusion:ButtonAdv Label="ðŸŽ“ Training Records"
                                          Background="{StaticResource BusBuddy.Brush.FleetGreen}"
                                          Foreground="White"
                                          BorderThickness="0"
                                          Padding="15,8"
                                          Command="{Binding TrainingRecordsCommand}"
                                          ToolTip="Manage training records"
                                          AutomationProperties.Name="Training Records"
                                          AutomationProperties.HelpText="Manage driver training records"/>
                </StackPanel>

                <!-- Search and Filter -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="ðŸ”" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <syncfusion:SfTextBoxExt x:Name="SearchTextBox"
                                             Width="200"
                                             Watermark="Search drivers..."
                                             Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             Padding="8"
                                             Margin="0,0,10,0"/>

                    <syncfusion:ComboBoxAdv x:Name="StatusFilterComboBox"
                                            Width="120"
                                            DefaultText="All Status"
                                            SelectedItem="{Binding SelectedStatusFilter, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                        <syncfusion:ComboBoxItemAdv Content="All Status"/>
                        <syncfusion:ComboBoxItemAdv Content="Active"/>
                        <syncfusion:ComboBoxItemAdv Content="Inactive"/>
                        <syncfusion:ComboBoxItemAdv Content="Training"/>
                        <syncfusion:ComboBoxItemAdv Content="License Expiring"/>
                    </syncfusion:ComboBoxAdv>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content Area with DockingManager -->
        <syncfusion:DockingManager Grid.Row="2" x:Name="MainDockingManager"
                                   UseDocumentContainer="True"
                                   PersistState="True">

            <!-- Drivers List Panel -->
            <ContentControl syncfusion:DockingManager.Header="ðŸ‘¨â€âœˆï¸ Driver Directory"
                            syncfusion:DockingManager.State="Dock"
                            syncfusion:DockingManager.SideInDockedMode="Left"
                            syncfusion:DockingManager.DesiredWidthInDockedMode="600">
                <Grid Margin="10">
                    <syncfusion:SfDataGrid x:Name="DriversDataGrid"
                                           ItemsSource="{Binding FilteredDrivers}"
                                           SelectedItem="{Binding SelectedDriver, Mode=TwoWay}"
                                           AutoGenerateColumns="False"
                                           AllowEditing="False"
                                           AllowSorting="True"
                                           AllowFiltering="True"
                                           AllowGrouping="True"
                                           ShowGroupDropArea="True"
                                           ShowRowHeader="True"
                                           SelectionMode="Single"
                                           GridLinesVisibility="Both"
                                           HeaderLinesVisibility="Both"
                                           ColumnSizer="Star"
                                           AutomationProperties.Name="Drivers Data Grid">

                        <syncfusion:SfDataGrid.Columns>
                            <syncfusion:GridTextColumn HeaderText="ID" MappingName="DriverId" Width="80"/>
                            <syncfusion:GridTextColumn HeaderText="Driver Name" MappingName="DriverName" Width="150"/>
                            <syncfusion:GridTextColumn HeaderText="License #" MappingName="LicenseNumber" Width="120"/>
                            <syncfusion:GridTextColumn HeaderText="License Type" MappingName="DriversLicenceType" Width="100"/>
                            <syncfusion:GridDateTimeColumn HeaderText="License Expiry" MappingName="LicenseExpiryDate" Width="110"/>
                            <syncfusion:GridTextColumn HeaderText="Phone" MappingName="DriverPhone" Width="120"/>
                            <syncfusion:GridTextColumn HeaderText="Email" MappingName="DriverEmail" Width="180"/>
                            <syncfusion:GridTextColumn HeaderText="Status" MappingName="Status" Width="90"/>
                        </syncfusion:SfDataGrid.Columns>
                    </syncfusion:SfDataGrid>
                </Grid>
            </ContentControl>

            <!-- Driver Details Panel -->
            <ContentControl syncfusion:DockingManager.Header="ðŸ“‹ Driver Details"
                            syncfusion:DockingManager.State="Dock"
                            syncfusion:DockingManager.SideInDockedMode="Right"
                            syncfusion:DockingManager.DesiredWidthInDockedMode="400">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="15">
                    <StackPanel x:Name="DriverDetailsPanel">
                        <Border Background="{StaticResource BusBuddy.Surface.Medium}"
                                CornerRadius="6" Padding="15" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="Driver Information"
                                           FontSize="16" FontWeight="Bold"
                                           Foreground="{StaticResource BusBuddy.Text.Primary}"
                                           Margin="0,0,0,10"/>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Name:" FontWeight="SemiBold" Margin="0,5"/>
                                    <TextBlock Grid.Row="0" Grid.Column="1" x:Name="DriverNameText" Text="{Binding SelectedDriver.DriverName}" Margin="0,5"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="License:" FontWeight="SemiBold" Margin="0,5"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1" x:Name="LicenseNumberText" Text="{Binding SelectedDriver.LicenseNumber}" Margin="0,5"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Phone:" FontWeight="SemiBold" Margin="0,5"/>
                                    <TextBlock Grid.Row="2" Grid.Column="1" x:Name="PhoneText" Text="{Binding SelectedDriver.DriverPhone}" Margin="0,5"/>

                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Status:" FontWeight="SemiBold" Margin="0,5"/>
                                    <TextBlock Grid.Row="3" Grid.Column="1" x:Name="StatusText" Text="{Binding SelectedDriver.Status}" Margin="0,5"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- License Information -->
                        <Border Background="{StaticResource BusBuddy.Surface.Medium}"
                                CornerRadius="6" Padding="15" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="License Details"
                                           FontSize="16" FontWeight="Bold"
                                           Foreground="{StaticResource BusBuddy.Text.Primary}"
                                           Margin="0,0,0,10"/>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Type:" FontWeight="SemiBold" Margin="0,5"/>
                                    <TextBlock Grid.Row="0" Grid.Column="1" x:Name="LicenseTypeText" Text="{Binding SelectedDriver.DriversLicenceType}" Margin="0,5"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Expires:" FontWeight="SemiBold" Margin="0,5"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1" x:Name="ExpiryDateText" Text="{Binding SelectedDriver.LicenseExpiryDate, StringFormat=MM/dd/yyyy}" Margin="0,5"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Days Left:" FontWeight="SemiBold" Margin="0,5"/>
                                    <TextBlock Grid.Row="2" Grid.Column="1" x:Name="DaysLeftText" Text="{Binding SelectedDriver.LicenseStatus}" Margin="0,5"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Quick Actions -->
                        <Border Background="{StaticResource BusBuddy.Surface.Medium}"
                                CornerRadius="6" Padding="15">
                            <StackPanel>
                                <TextBlock Text="Quick Actions"
                                           FontSize="16" FontWeight="Bold"
                                           Foreground="{StaticResource BusBuddy.Text.Primary}"
                                           Margin="0,0,0,10"/>

                                <syncfusion:ButtonAdv Label="ðŸ“ Edit Details"
                                                      Margin="0,0,0,8"
                                                      HorizontalAlignment="Stretch"
                                                      Command="{Binding EditDetailsCommand}"
                                                      x:Name="EditDetailsButton"/>

                                <syncfusion:ButtonAdv Label="ðŸ“„ View License"
                                                      Margin="0,0,0,8"
                                                      HorizontalAlignment="Stretch"
                                                      Command="{Binding ViewLicenseCommand}"
                                                      x:Name="ViewLicenseButton"/>

                                <syncfusion:ButtonAdv Label="ðŸŽ“ Training History"
                                                      Margin="0,0,0,8"
                                                      HorizontalAlignment="Stretch"
                                                      Command="{Binding TrainingHistoryCommand}"
                                                      x:Name="TrainingHistoryButton"/>

                                <syncfusion:ButtonAdv Label="ðŸšŒ Assign Route"
                                                      HorizontalAlignment="Stretch"
                                                      Command="{Binding AssignRouteCommand}"
                                                      x:Name="AssignRouteButton"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </ContentControl>

            <!-- Statistics Dashboard -->
            <ContentControl syncfusion:DockingManager.Header="ðŸ“Š Driver Statistics"
                            syncfusion:DockingManager.State="Document">
                <Grid Margin="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Statistics Cards -->
                    <UniformGrid Grid.Row="0" Rows="1" Columns="4" Margin="0,0,0,20">
                        <!-- Total Drivers Card -->
                        <Border Background="{StaticResource BusBuddy.Brush.Primary}"
                                CornerRadius="8" Padding="20" Margin="0,0,10,0">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="ðŸ‘¥" FontSize="32" HorizontalAlignment="Center" Foreground="White"/>
                                <TextBlock x:Name="TotalDriversText" Text="{Binding TotalDrivers}" FontSize="24" FontWeight="Bold"
                                           HorizontalAlignment="Center" Foreground="White"/>
                                <TextBlock Text="Total Drivers" FontSize="12" HorizontalAlignment="Center"
                                           Foreground="White" Opacity="0.9"/>
                            </StackPanel>
                        </Border>

                        <!-- Active Drivers Card -->
                        <Border Background="{StaticResource BusBuddy.Brush.Semantic.Success}"
                                CornerRadius="8" Padding="20" Margin="0,0,10,0">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="âœ…" FontSize="32" HorizontalAlignment="Center" Foreground="White"/>
                                <TextBlock x:Name="ActiveDriversText" Text="{Binding ActiveDrivers}" FontSize="24" FontWeight="Bold"
                                           HorizontalAlignment="Center" Foreground="White"/>
                                <TextBlock Text="Active" FontSize="12" HorizontalAlignment="Center"
                                           Foreground="White" Opacity="0.9"/>
                            </StackPanel>
                        </Border>

                        <!-- Expiring Licenses Card -->
                        <Border Background="{StaticResource BusBuddy.Brush.Semantic.Warning}"
                                CornerRadius="8" Padding="20" Margin="0,0,10,0">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="âš ï¸" FontSize="32" HorizontalAlignment="Center" Foreground="White"/>
                                <TextBlock x:Name="ExpiringLicensesText" Text="{Binding ExpiringLicensesCount}" FontSize="24" FontWeight="Bold"
                                           HorizontalAlignment="Center" Foreground="White"/>
                                <TextBlock Text="Expiring Soon" FontSize="12" HorizontalAlignment="Center"
                                           Foreground="White" Opacity="0.9"/>
                            </StackPanel>
                        </Border>

                        <!-- Training Pending Card -->
                        <Border Background="{StaticResource BusBuddy.Brush.SafetyOrange}"
                                CornerRadius="8" Padding="20">
                            <StackPanel HorizontalAlignment="Center">
                                <TextBlock Text="ðŸŽ“" FontSize="32" HorizontalAlignment="Center" Foreground="White"/>
                                <TextBlock x:Name="TrainingPendingText" Text="{Binding TrainingPendingDrivers}" FontSize="24" FontWeight="Bold"
                                           HorizontalAlignment="Center" Foreground="White"/>
                                <TextBlock Text="Training Pending" FontSize="12" HorizontalAlignment="Center"
                                           Foreground="White" Opacity="0.9"/>
                            </StackPanel>
                        </Border>
                    </UniformGrid>

                    <!-- Charts Area -->
                    <syncfusion:SfChart Grid.Row="1" x:Name="DriverStatsChart"
                                        Header="Driver Status Distribution"
                                        FontSize="16" FontWeight="Bold">
                        <syncfusion:PieSeries ItemsSource="{Binding DriverStatusData}"
                                              XBindingPath="Status"
                                              YBindingPath="Count"
                                              LabelPosition="Outside"
                                              EnableSmartLabels="True">
                            <syncfusion:PieSeries.AdornmentsInfo>
                                <syncfusion:ChartAdornmentInfo ShowLabel="True"
                                                             LabelPosition="Outside"
                                                             ShowConnectorLine="True"/>
                            </syncfusion:PieSeries.AdornmentsInfo>
                        </syncfusion:PieSeries>
                    </syncfusion:SfChart>
                </Grid>
            </ContentControl>

        </syncfusion:DockingManager>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="{StaticResource BusBuddy.Surface.Dark}"
                CornerRadius="6" Padding="15" Margin="0,15,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" x:Name="StatusMessageText"
                           Text="{Binding StatusMessage}"
                           Foreground="{StaticResource BusBuddy.Text.Secondary}"
                           VerticalAlignment="Center"/>

                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Last Updated: "
                               Foreground="{StaticResource BusBuddy.Text.Secondary}"/>
                    <TextBlock x:Name="LastUpdatedText"
                               Text="{Binding LastUpdated, StringFormat='{}{0:MM/dd/yyyy HH:mm}'}"
                               FontWeight="Bold"
                               Foreground="{StaticResource BusBuddy.Text.Primary}"
                               xmlns:sys="clr-namespace:System;assembly=mscorlib"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
